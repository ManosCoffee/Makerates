{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.11.2", "generated_at": "2026-01-28T23:11:31.741837Z", "invocation_id": "145411ea-5eae-4ce4-b7f8-8a651b5bd8ab", "invocation_started_at": "2026-01-28T23:11:29.848574Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.420306Z", "completed_at": "2026-01-28T23:11:30.420313Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.420948Z", "completed_at": "2026-01-28T23:11:30.449781Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03830575942993164, "adapter_response": {"_message": "INSERT 34", "code": "INSERT", "rows_affected": 34}, "message": "INSERT 34", "failures": null, "unique_id": "seed.makerates.country_currencies", "compiled": null, "compiled_code": null, "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.412368Z", "completed_at": "2026-01-28T23:11:30.451526Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.451883Z", "completed_at": "2026-01-28T23:11:30.493460Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.08383893966674805, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.stg_currencylayer", "compiled": true, "compiled_code": "\n\n-- CurrencyLayer Staging\n-- Base Currency is typically USD (Free Tier) or EUR (Paid)\n\nWITH bronze_data AS (\n    -- Read from Raw Iceberg Table\n    SELECT *\n    FROM iceberg_scan('s3://silver-bucket/iceberg/currencylayer_rates/metadata/00007-a32637fe-b979-4f3e-beb1-7d0bee54b5cc.metadata.json')\n    WHERE source = 'currencylayer'\n),\n\n-- Extract all rates__* columns into rows using UNPIVOT\nunnested_rates AS (\n    UNPIVOT bronze_data\n    ON COLUMNS('^rates__.*')\n    INTO\n        NAME target_currency\n        VALUE exchange_rate\n),\n\nranked_rates AS (\n    SELECT \n        *,\n        ROW_NUMBER() OVER (\n            PARTITION BY base_currency, target_currency, rate_date \n            ORDER BY extraction_timestamp DESC\n        ) as rn\n    FROM unnested_rates\n),\n\ndeduplicated AS (\n    -- Deduplicate for each rate_date based on LATEST extraction_timestamp\n    SELECT * FROM ranked_rates\n    WHERE rn = 1\n)\n\nSELECT\n    extraction_id,\n    CAST(extraction_timestamp AS TIMESTAMP) AS extraction_timestamp,\n    source,\n    source_tier,\n    base_currency,\n    UPPER(REPLACE(target_currency, 'rates__', '')) AS target_currency,\n    CAST(exchange_rate AS DOUBLE) AS exchange_rate,\n    CAST(rate_date AS DATE) AS rate_date,\n    CONCAT(base_currency, '/', UPPER(REPLACE(target_currency, 'rates__', ''))) AS currency_pair,\n    1.0 / exchange_rate AS inverse_rate,  -- For reverse calculations\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM deduplicated\nWHERE exchange_rate > 0\nORDER BY extraction_timestamp DESC, target_currency", "relation_name": "\"analytics\".\"main_staging\".\"stg_currencylayer\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.419065Z", "completed_at": "2026-01-28T23:11:30.466041Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.467883Z", "completed_at": "2026-01-28T23:11:30.512009Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.10906028747558594, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.stg_frankfurter", "compiled": true, "compiled_code": "\n\n/*\nStaging model for Frankfurter (ECB) rates.\n\nReads Bronze JSONL data from dlt and unpacks the flattened rates columns\ninto a normalized structure suitable for consensus checking.\n\nSource: Public Frankfurter API (ECB data)\nSecondary Source for EUR-based exchange rates\n*/\n\nWITH bronze_data AS (\n    -- Read from Raw Iceberg Table (Compacted & Deduplicated)\n    SELECT *\n    FROM iceberg_scan('s3://silver-bucket/iceberg/frankfurter_rates/metadata/00015-1ac105ee-d9f6-4b91-a942-6e2033fb479c.metadata.json')\n    WHERE source = 'frankfurter'\n),\n\n-- Extract all rates__* columns into rows using UNPIVOT\nunnested_rates AS (\n    UNPIVOT bronze_data\n    ON COLUMNS('^rates__.*')\n    INTO\n        NAME target_currency\n        VALUE exchange_rate\n),\n\nranked_rates AS (\n    SELECT \n        *,\n        ROW_NUMBER() OVER (\n            PARTITION BY base_currency, target_currency, rate_date \n            ORDER BY extraction_timestamp DESC\n        ) as rn\n    FROM unnested_rates\n),\n\ndeduplicated AS (\n    -- Deduplicate for each rate_date based on LATEST extraction_timestamp\n    SELECT * FROM ranked_rates\n    WHERE rn = 1\n)\n\nSELECT\n    extraction_id,\n    CAST(extraction_timestamp AS TIMESTAMP) AS extraction_timestamp,\n    source,\n    source_tier,\n    base_currency,\n    UPPER(REPLACE(target_currency, 'rates__', '')) AS target_currency,\n    CAST(exchange_rate AS DOUBLE) AS exchange_rate,\n    CAST(rate_date AS DATE) AS rate_date,\n    CONCAT(base_currency, '/', UPPER(REPLACE(target_currency, 'rates__', ''))) AS currency_pair,\n    1.0 / exchange_rate AS inverse_rate,  -- For reverse calculations\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM deduplicated\nWHERE exchange_rate > 0\nORDER BY extraction_timestamp DESC, target_currency", "relation_name": "\"analytics\".\"main_staging\".\"stg_frankfurter\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.417150Z", "completed_at": "2026-01-28T23:11:30.465804Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.466205Z", "completed_at": "2026-01-28T23:11:30.520440Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.10995697975158691, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.stg_exchangerate", "compiled": true, "compiled_code": "\n\n/*\nStaging model for ExchangeRate-API rates.\n\nReads Bronze JSONL data from dlt and unpacks the flattened rates columns\ninto a normalized structure suitable for consensus checking.\n\nSource: ExchangeRate-API (free tier)\nPrimary Source for USD-based exchange rates\n*/\n\nWITH bronze_data AS (\n    -- Read from Raw Iceberg Table\n    SELECT *\n    FROM iceberg_scan('s3://silver-bucket/iceberg/exchangerate_rates/metadata/00009-50799cdb-17a2-4814-8a6f-67389f091131.metadata.json')\n    WHERE source = 'exchangerate'\n),\n\n-- Extract all rates__* columns into rows using UNPIVOT\n-- Using same currency list as Frankfurter for consistency\nunnested_rates AS (\n    UNPIVOT bronze_data\n    ON COLUMNS('^rates__.*')\n    INTO\n        NAME target_currency\n        VALUE exchange_rate\n),\n\nranked_rates AS (\n    SELECT \n        *,\n        ROW_NUMBER() OVER (\n            PARTITION BY base_currency, target_currency, rate_date \n            ORDER BY extraction_timestamp DESC\n        ) as rn\n    FROM unnested_rates\n),\n\ndeduplicated AS (\n    -- Deduplicate for each rate_date based on LATEST extraction_timestamp\n    SELECT * FROM ranked_rates\n    WHERE rn = 1\n)\n\nSELECT\n    extraction_id,\n    CAST(extraction_timestamp AS TIMESTAMP) AS extraction_timestamp,\n    source,\n    source_tier,\n    base_currency,\n    UPPER(REPLACE(target_currency, 'rates__', '')) AS target_currency,\n    CAST(exchange_rate AS DOUBLE) AS exchange_rate,\n    CAST(rate_date AS DATE) AS rate_date,\n    CONCAT(base_currency, '/', UPPER(REPLACE(target_currency, 'rates__', ''))) AS currency_pair,\n    1.0 / exchange_rate AS inverse_rate,  -- For reverse calculations\n    CURRENT_TIMESTAMP AS dbt_loaded_at\nFROM deduplicated\nWHERE exchange_rate > 0\nORDER BY extraction_timestamp DESC, target_currency", "relation_name": "\"analytics\".\"main_staging\".\"stg_exchangerate\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.470350Z", "completed_at": "2026-01-28T23:11:30.472176Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.472603Z", "completed_at": "2026-01-28T23:11:30.521152Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.054145097732543945, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.dim_countries", "compiled": true, "compiled_code": "\n\nSELECT\n    UPPER(country_code) as country_code,\n    country_name,\n    UPPER(currency_code) as currency_code,\n    region\nFROM \"analytics\".\"main_analytics\".\"country_currencies\"", "relation_name": "\"analytics\".\"main_analytics\".\"dim_countries\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.504341Z", "completed_at": "2026-01-28T23:11:30.511456Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.512292Z", "completed_at": "2026-01-28T23:11:30.611498Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.11058783531188965, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_stg_currencylayer_base_currency__USD.81029fd1d3", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        base_currency as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_staging\".\"stg_currencylayer\"\n    group by base_currency\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'USD'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.527665Z", "completed_at": "2026-01-28T23:11:30.535226Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.535558Z", "completed_at": "2026-01-28T23:11:30.899279Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.3777930736541748, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_stg_currencylayer_exchange_rate___0.e6d6dc79f0", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\n\nwhere not(exchange_rate > 0)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.613681Z", "completed_at": "2026-01-28T23:11:30.620257Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.620543Z", "completed_at": "2026-01-28T23:11:30.900999Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.2947871685028076, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_unique_combination_of_columns_stg_currencylayer_base_currency__target_currency__rate_date.1457da4350", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        base_currency, target_currency, rate_date\n    from \"analytics\".\"main_staging\".\"stg_currencylayer\"\n    group by base_currency, target_currency, rate_date\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.530762Z", "completed_at": "2026-01-28T23:11:30.535379Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.536394Z", "completed_at": "2026-01-28T23:11:30.902413Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.38402700424194336, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_stg_currencylayer_exchange_rate___1000000.536bb8f234", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\n\nwhere not(exchange_rate < 1000000)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.525644Z", "completed_at": "2026-01-28T23:11:30.533185Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.533415Z", "completed_at": "2026-01-28T23:11:30.907057Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.3865187168121338, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_stg_currencylayer_source__currencylayer.b2fdce2348", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        source as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_staging\".\"stg_currencylayer\"\n    group by source\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'currencylayer'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.925649Z", "completed_at": "2026-01-28T23:11:30.932272Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.932787Z", "completed_at": "2026-01-28T23:11:30.989695Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.06776618957519531, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_currencylayer_extraction_timestamp.21b990635d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect extraction_timestamp\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\nwhere extraction_timestamp is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.912548Z", "completed_at": "2026-01-28T23:11:30.920863Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.924137Z", "completed_at": "2026-01-28T23:11:30.995305Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.08541584014892578, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_currencylayer_base_currency.44e5742f2b", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect base_currency\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\nwhere base_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.918180Z", "completed_at": "2026-01-28T23:11:30.928789Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.929201Z", "completed_at": "2026-01-28T23:11:30.998566Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.09288191795349121, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_currencylayer_exchange_rate.127e6b8908", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect exchange_rate\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\nwhere exchange_rate is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.921090Z", "completed_at": "2026-01-28T23:11:30.928993Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.930726Z", "completed_at": "2026-01-28T23:11:31.006194Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.0951988697052002, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_currencylayer_extraction_id.3d67f319b6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect extraction_id\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\nwhere extraction_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:30.992689Z", "completed_at": "2026-01-28T23:11:30.997861Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:30.999043Z", "completed_at": "2026-01-28T23:11:31.060315Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.06893491744995117, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_currencylayer_rate_date.94960fc5b6", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rate_date\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\nwhere rate_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.017730Z", "completed_at": "2026-01-28T23:11:31.026687Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.028306Z", "completed_at": "2026-01-28T23:11:31.063646Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.05448770523071289, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_currencylayer_target_currency.abc7f288b9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect target_currency\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\nwhere target_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.009942Z", "completed_at": "2026-01-28T23:11:31.013158Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.014162Z", "completed_at": "2026-01-28T23:11:31.067727Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06339216232299805, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_currencylayer_source.a96939497c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect source\nfrom \"analytics\".\"main_staging\".\"stg_currencylayer\"\nwhere source is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.020849Z", "completed_at": "2026-01-28T23:11:31.027801Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.030203Z", "completed_at": "2026-01-28T23:11:31.073456Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.06567931175231934, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_stg_frankfurter_base_currency__EUR.c579bd764d", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        base_currency as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_staging\".\"stg_frankfurter\"\n    group by base_currency\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'EUR'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.064668Z", "completed_at": "2026-01-28T23:11:31.077113Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.078528Z", "completed_at": "2026-01-28T23:11:31.143421Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.08507108688354492, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_stg_frankfurter_source__frankfurter.68c678ca8d", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        source as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_staging\".\"stg_frankfurter\"\n    group by source\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'frankfurter'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.074326Z", "completed_at": "2026-01-28T23:11:31.081746Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.082542Z", "completed_at": "2026-01-28T23:11:31.144111Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0752267837524414, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_stg_frankfurter_exchange_rate___0.8848a07cca", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\n\nwhere not(exchange_rate > 0)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.090005Z", "completed_at": "2026-01-28T23:11:31.093837Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.094173Z", "completed_at": "2026-01-28T23:11:31.147668Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.06222891807556152, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_unique_combination_of_columns_stg_frankfurter_base_currency__target_currency__rate_date.3d9c262b9d", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        base_currency, target_currency, rate_date\n    from \"analytics\".\"main_staging\".\"stg_frankfurter\"\n    group by base_currency, target_currency, rate_date\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.084729Z", "completed_at": "2026-01-28T23:11:31.087955Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.088574Z", "completed_at": "2026-01-28T23:11:31.146981Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.06880617141723633, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_stg_frankfurter_exchange_rate___1000000.dc72f22c47", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\n\nwhere not(exchange_rate < 1000000)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.153340Z", "completed_at": "2026-01-28T23:11:31.158351Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.161876Z", "completed_at": "2026-01-28T23:11:31.179824Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.029742956161499023, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_frankfurter_base_currency.b1b845faa5", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect base_currency\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\nwhere base_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.156011Z", "completed_at": "2026-01-28T23:11:31.162749Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.163074Z", "completed_at": "2026-01-28T23:11:31.183081Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03313422203063965, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_frankfurter_exchange_rate.08c64f959c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect exchange_rate\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\nwhere exchange_rate is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.158571Z", "completed_at": "2026-01-28T23:11:31.164177Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.164441Z", "completed_at": "2026-01-28T23:11:31.182462Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.030750036239624023, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_frankfurter_extraction_id.705a3cb13f", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect extraction_id\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\nwhere extraction_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.160333Z", "completed_at": "2026-01-28T23:11:31.165945Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.166287Z", "completed_at": "2026-01-28T23:11:31.183903Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03116583824157715, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_frankfurter_extraction_timestamp.80f4fcc0dd", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect extraction_timestamp\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\nwhere extraction_timestamp is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.187972Z", "completed_at": "2026-01-28T23:11:31.192120Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.194109Z", "completed_at": "2026-01-28T23:11:31.212547Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.02692723274230957, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_frankfurter_rate_date.e8a376764d", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rate_date\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\nwhere rate_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.195055Z", "completed_at": "2026-01-28T23:11:31.199912Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.200454Z", "completed_at": "2026-01-28T23:11:31.221060Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03108668327331543, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_frankfurter_target_currency.9a8f679680", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect target_currency\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\nwhere target_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.192424Z", "completed_at": "2026-01-28T23:11:31.198372Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.198527Z", "completed_at": "2026-01-28T23:11:31.222468Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03503894805908203, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_frankfurter_source.11f9ce2497", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect source\nfrom \"analytics\".\"main_staging\".\"stg_frankfurter\"\nwhere source is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.196548Z", "completed_at": "2026-01-28T23:11:31.200294Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.201586Z", "completed_at": "2026-01-28T23:11:31.233606Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.04381585121154785, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_stg_exchangerate_base_currency__USD.f9434c049b", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        base_currency as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_staging\".\"stg_exchangerate\"\n    group by base_currency\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'USD'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.228410Z", "completed_at": "2026-01-28T23:11:31.234432Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.234777Z", "completed_at": "2026-01-28T23:11:31.339386Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.12004804611206055, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_stg_exchangerate_exchange_rate___0.615421432e", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\n\nwhere not(exchange_rate > 0)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.230938Z", "completed_at": "2026-01-28T23:11:31.234627Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.235991Z", "completed_at": "2026-01-28T23:11:31.340329Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.11803221702575684, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_stg_exchangerate_exchange_rate___1000000000.ac27b43a39", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\n\nwhere not(exchange_rate < 1000000000)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.215005Z", "completed_at": "2026-01-28T23:11:31.222900Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.223689Z", "completed_at": "2026-01-28T23:11:31.341679Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.13447904586791992, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_stg_exchangerate_source__exchangerate.a98af4ab66", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        source as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_staging\".\"stg_exchangerate\"\n    group by source\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'exchangerate'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.239537Z", "completed_at": "2026-01-28T23:11:31.241686Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.241872Z", "completed_at": "2026-01-28T23:11:31.343094Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.11052799224853516, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_unique_combination_of_columns_stg_exchangerate_base_currency__target_currency__rate_date.82af2fc52b", "compiled": true, "compiled_code": "\n\n\n\n\n\nwith validation_errors as (\n\n    select\n        base_currency, target_currency, rate_date\n    from \"analytics\".\"main_staging\".\"stg_exchangerate\"\n    group by base_currency, target_currency, rate_date\n    having count(*) > 1\n\n)\n\nselect *\nfrom validation_errors\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.352300Z", "completed_at": "2026-01-28T23:11:31.361474Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.361772Z", "completed_at": "2026-01-28T23:11:31.378583Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.029074907302856445, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_exchangerate_base_currency.0f600887d9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect base_currency\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\nwhere base_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.354428Z", "completed_at": "2026-01-28T23:11:31.360362Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.360557Z", "completed_at": "2026-01-28T23:11:31.384546Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03861713409423828, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_exchangerate_exchange_rate.872e941625", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect exchange_rate\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\nwhere exchange_rate is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.356174Z", "completed_at": "2026-01-28T23:11:31.361608Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.362691Z", "completed_at": "2026-01-28T23:11:31.388131Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03866910934448242, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_exchangerate_extraction_id.e4ac7ca721", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect extraction_id\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\nwhere extraction_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.358531Z", "completed_at": "2026-01-28T23:11:31.363619Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.364031Z", "completed_at": "2026-01-28T23:11:31.388657Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03897666931152344, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_exchangerate_extraction_timestamp.048fca9fbe", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect extraction_timestamp\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\nwhere extraction_timestamp is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.381927Z", "completed_at": "2026-01-28T23:11:31.390765Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.391483Z", "completed_at": "2026-01-28T23:11:31.414504Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.03395891189575195, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_exchangerate_rate_date.277fc2ef10", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rate_date\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\nwhere rate_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.394534Z", "completed_at": "2026-01-28T23:11:31.398274Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.398467Z", "completed_at": "2026-01-28T23:11:31.416757Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.024677753448486328, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_exchangerate_source.b009f80977", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect source\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\nwhere source is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.396339Z", "completed_at": "2026-01-28T23:11:31.401177Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.401429Z", "completed_at": "2026-01-28T23:11:31.418000Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.02532196044921875, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_stg_exchangerate_target_currency.31427bbeef", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect target_currency\nfrom \"analytics\".\"main_staging\".\"stg_exchangerate\"\nwhere target_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.420501Z", "completed_at": "2026-01-28T23:11:31.422949Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.423089Z", "completed_at": "2026-01-28T23:11:31.461205Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.04116678237915039, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.consensus_check", "compiled": true, "compiled_code": "\n\n/*\nConsensus Check: Multi-Source Validation\nSources: ExchangeRate-API (Primary), Frankfurter (Secondary), CurrencyLayer (Tertiary/Failover)\n\nLogic:\n1. Normalize all rates to EUR base.\n2. Calculate Median Rate (Consensus).\n3. Flag sources deviating > 0.5% from Median.\n*/\n\nWITH \n-- 1. Standardize Inputs\nfrank AS (\n    SELECT rate_date, target_currency, exchange_rate as rate, 'frankfurter' as source\n    FROM \"analytics\".\"main_staging\".\"stg_frankfurter\"\n    WHERE base_currency = 'EUR'\n),\n\n-- CurrencyLayer: Handle EUR and USD base\ncl_raw AS (\n    SELECT rate_date, base_currency, target_currency, exchange_rate\n    FROM \"analytics\".\"main_staging\".\"stg_currencylayer\"\n),\n\ncl_eur_base AS (\n    SELECT rate_date, target_currency, exchange_rate as rate\n    FROM cl_raw\n    WHERE base_currency = 'EUR'\n),\n\ncl_usd_base_pairs AS (\n    SELECT rate_date, exchange_rate as usd_eur_rate\n    FROM cl_raw\n    WHERE base_currency = 'USD' AND target_currency = 'EUR'\n),\n\ncl_normalized AS (\n    SELECT \n        r.rate_date, \n        r.target_currency, \n        r.exchange_rate / u.usd_eur_rate as rate,\n        'currencylayer' as source\n    FROM cl_raw r\n    JOIN cl_usd_base_pairs u ON r.rate_date = u.rate_date\n    WHERE r.base_currency = 'USD'\n    \n    UNION ALL\n    \n    SELECT *, 'currencylayer' as source FROM cl_eur_base\n),\n\n-- ExchangeRate-API is USD based, convert to EUR (Self-contained normalization)\ner_raw AS (\n    SELECT rate_date, base_currency, target_currency, exchange_rate\n    FROM \"analytics\".\"main_staging\".\"stg_exchangerate\"\n),\n\ner_usd_eur AS (\n    SELECT rate_date, exchange_rate as usd_to_eur\n    FROM er_raw\n    WHERE base_currency = 'USD' AND target_currency = 'EUR'\n),\n\ner_normalized AS (\n    SELECT \n        e.rate_date, \n        e.target_currency, \n        e.exchange_rate / u.usd_to_eur as rate, \n        'exchangerate' as source\n    FROM er_raw e\n    JOIN er_usd_eur u ON e.rate_date = u.rate_date\n    WHERE e.base_currency = 'USD'\n),\n\n-- 2. Union All Sources\nall_rates AS (\n    SELECT * FROM frank\n    UNION ALL\n    SELECT * FROM cl_normalized\n    UNION ALL\n    SELECT * FROM er_normalized\n),\n\n-- 3. Calculate Consensus (Median) per Date/Currency\nstats AS (\n    SELECT\n        rate_date,\n        target_currency,\n        MEDIAN(rate) as consensus_rate,\n        COUNT(*) as source_count,\n        LISTagg(source || ':' || ROUND(rate, 4), ', ') as source_breakdown\n    FROM all_rates\n    GROUP BY 1, 2\n)\n\nSELECT\n    s.rate_date,\n    s.target_currency,\n    concat('EUR/', s.target_currency) as currency_pair,\n    s.consensus_rate,\n    s.source_count,\n    s.source_breakdown,\n    \n    -- Check specific deviations (for flagging)\n    -- We join back to source data to find who deviated\n    f.rate as frank_rate,\n    er.rate as exchangerate_rate,\n    cl.rate as currencylayer_rate,\n    \n    -- deviations\n    ABS(f.rate - s.consensus_rate) / s.consensus_rate as frank_dev,\n    ABS(f.rate - s.consensus_rate) / s.consensus_rate as variance_pct, -- Alias for downstream consumption\n    ABS(er.rate - s.consensus_rate) / s.consensus_rate as er_dev,\n    ABS(cl.rate - s.consensus_rate) / s.consensus_rate as cl_dev,\n    \n    CASE \n        WHEN ABS(f.rate - s.consensus_rate) / s.consensus_rate > 0.005 THEN 'FLAGGED'\n        WHEN ABS(er.rate - s.consensus_rate) / s.consensus_rate > 0.005 THEN 'FLAGGED'\n        WHEN ABS(cl.rate - s.consensus_rate) / s.consensus_rate > 0.005 THEN 'FLAGGED'\n        ELSE 'OK'\n    END as status,\n    \n    CASE \n        WHEN ABS(f.rate - s.consensus_rate) / s.consensus_rate > 0.005 THEN 'WARNING'\n        WHEN ABS(er.rate - s.consensus_rate) / s.consensus_rate > 0.005 THEN 'WARNING'\n        WHEN ABS(cl.rate - s.consensus_rate) / s.consensus_rate > 0.005 THEN 'WARNING'\n        ELSE 'OK'\n    END as severity,\n    \n    CURRENT_TIMESTAMP as dbt_loaded_at\n    \nFROM stats s\nLEFT JOIN frank f ON s.rate_date = f.rate_date AND s.target_currency = f.target_currency\nLEFT JOIN er_normalized er ON s.rate_date = er.rate_date AND s.target_currency = er.target_currency\nLEFT JOIN cl_normalized cl ON s.rate_date = cl.rate_date AND s.target_currency = cl.target_currency\nWHERE s.consensus_rate IS NOT NULL\n  AND (\n      s.rate_date = CAST('1970-01-01' AS DATE)\n      OR 'daily' = 'backfill'\n  )", "relation_name": "\"analytics\".\"main_validation\".\"consensus_check\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.469151Z", "completed_at": "2026-01-28T23:11:31.474523Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.474664Z", "completed_at": "2026-01-28T23:11:31.481818Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.018723726272583008, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_consensus_check_variance_pct___0_005.67f0695f9e", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_validation\".\"consensus_check\"\n\nwhere not(variance_pct > 0.005)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.464796Z", "completed_at": "2026-01-28T23:11:31.473447Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.473630Z", "completed_at": "2026-01-28T23:11:31.486815Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.02581310272216797, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_consensus_check_severity__WARNING__CRITICAL.0db4898c17", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        severity as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_validation\".\"consensus_check\"\n    group by severity\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'WARNING','CRITICAL'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.467273Z", "completed_at": "2026-01-28T23:11:31.476561Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.476739Z", "completed_at": "2026-01-28T23:11:31.492607Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.03135108947753906, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_consensus_check_status__FLAGGED.c449ff4a49", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        status as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_validation\".\"consensus_check\"\n    group by status\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'FLAGGED'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.470970Z", "completed_at": "2026-01-28T23:11:31.475537Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.475672Z", "completed_at": "2026-01-28T23:11:31.499742Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.03701472282409668, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_consensus_check_severity.f147cd3533", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect severity\nfrom \"analytics\".\"main_validation\".\"consensus_check\"\nwhere severity is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.484644Z", "completed_at": "2026-01-28T23:11:31.487932Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.488271Z", "completed_at": "2026-01-28T23:11:31.504414Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.021044015884399414, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_consensus_check_status.69a6dd698a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect status\nfrom \"analytics\".\"main_validation\".\"consensus_check\"\nwhere status is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.490584Z", "completed_at": "2026-01-28T23:11:31.493785Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.494253Z", "completed_at": "2026-01-28T23:11:31.507034Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.018130064010620117, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_consensus_check_target_currency.9a17030410", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect target_currency\nfrom \"analytics\".\"main_validation\".\"consensus_check\"\nwhere target_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.496591Z", "completed_at": "2026-01-28T23:11:31.500990Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.501665Z", "completed_at": "2026-01-28T23:11:31.508760Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.013443946838378906, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_consensus_check_variance_pct.eee90b65bd", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect variance_pct\nfrom \"analytics\".\"main_validation\".\"consensus_check\"\nwhere variance_pct is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.510868Z", "completed_at": "2026-01-28T23:11:31.512772Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.512956Z", "completed_at": "2026-01-28T23:11:31.530755Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.020392894744873047, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.fact_rates_validated", "compiled": true, "compiled_code": "\n\n/*\nFact Rates Validated: Final Validation Layer Output\n\nThis is the SINGLE SOURCE OF TRUTH for currency rates.\n- Uses Frankfurter (ECB) as primary source\n- Only includes rates that passed consensus validation\n- Ready to sync to DynamoDB Hot tier for downstream services\n\nValidation Rules:\n- HTTP 200 response from API\n- Rate > 0 (no nulls or zeros)\n- Consensus check passed (variance <0.5% vs Open Exchange)\n- Latest extraction per day (deduplication)\n*/\n\nWITH frank_latest AS (\n    -- Get most recent extraction per day\n    SELECT\n        *,\n        ROW_NUMBER() OVER (\n            PARTITION BY target_currency, rate_date\n            ORDER BY extraction_timestamp DESC\n        ) AS rn\n    FROM \"analytics\".\"main_staging\".\"stg_frankfurter\"\n),\n\nfrank_deduplicated AS (\n    SELECT\n        extraction_id,\n        extraction_timestamp,\n        source,\n        source_tier,\n        base_currency,\n        target_currency,\n        exchange_rate,\n        rate_date,\n        currency_pair,\n        inverse_rate\n    FROM frank_latest\n    WHERE rn = 1  -- Only latest extraction\n),\n\n-- Get consensus check results (only flagged rates)\nanomalies AS (\n    SELECT DISTINCT\n        target_currency,\n        rate_date,\n        variance_pct,\n        status,\n        severity\n    FROM \"analytics\".\"main_validation\".\"consensus_check\"\n    WHERE status = 'FLAGGED'\n)\n\nSELECT\n    -- Identifiers\n    f.extraction_id,\n    f.extraction_timestamp,\n    f.rate_date,\n    f.currency_pair,\n    f.base_currency,\n    f.target_currency,\n\n    -- Rates\n    f.exchange_rate,\n    f.inverse_rate,\n\n    -- Source metadata\n    f.source,\n    f.source_tier,\n\n    -- Validation status\n    CASE\n        WHEN a.target_currency IS NOT NULL THEN 'FLAGGED'\n        ELSE 'VALIDATED'\n    END AS validation_status,\n\n    COALESCE(a.severity, 'OK') AS severity,\n    COALESCE(a.variance_pct, 0.0) AS consensus_variance,\n\n    -- Metadata\n    CURRENT_TIMESTAMP AS dbt_loaded_at,\n    'fact_rates_validated' AS model_name\n\nFROM frank_deduplicated f\nLEFT JOIN anomalies a\n    ON f.target_currency = a.target_currency\n    AND f.rate_date = a.rate_date\n\n-- CRITICAL: Only include validated rates (no anomalies)\nWHERE validation_status = 'VALIDATED'\n\nORDER BY f.rate_date DESC, f.target_currency", "relation_name": "\"analytics\".\"main_validation\".\"fact_rates_validated\"", "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.536256Z", "completed_at": "2026-01-28T23:11:31.542526Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.542931Z", "completed_at": "2026-01-28T23:11:31.550611Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.01856708526611328, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_fact_rates_validated_severity__OK.97dffc8986", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        severity as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_validation\".\"fact_rates_validated\"\n    group by severity\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'OK'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.534392Z", "completed_at": "2026-01-28T23:11:31.542671Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.543802Z", "completed_at": "2026-01-28T23:11:31.552601Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.021465063095092773, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_fact_rates_validated_base_currency__EUR.0fc782c64e", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        base_currency as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_validation\".\"fact_rates_validated\"\n    group by base_currency\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'EUR'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.540010Z", "completed_at": "2026-01-28T23:11:31.542806Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.544769Z", "completed_at": "2026-01-28T23:11:31.558767Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.04026389122009277, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_fact_rates_validated_exchange_rate___0.d47873cd29", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\n\nwhere not(exchange_rate > 0)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.538200Z", "completed_at": "2026-01-28T23:11:31.544629Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.545706Z", "completed_at": "2026-01-28T23:11:31.574854Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.045426368713378906, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.accepted_values_fact_rates_validated_validation_status__VALIDATED.29836cbd05", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        validation_status as value_field,\n        count(*) as n_records\n\n    from \"analytics\".\"main_validation\".\"fact_rates_validated\"\n    group by validation_status\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'VALIDATED'\n)\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.555595Z", "completed_at": "2026-01-28T23:11:31.559086Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.559954Z", "completed_at": "2026-01-28T23:11:31.593306Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.04025387763977051, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_expression_is_true_fact_rates_validated_exchange_rate___1000000.00fddf7adb", "compiled": true, "compiled_code": "\n\n\n\nselect\n    1\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\n\nwhere not(exchange_rate < 1000000)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.560888Z", "completed_at": "2026-01-28T23:11:31.575455Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.576367Z", "completed_at": "2026-01-28T23:11:31.596387Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04109692573547363, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.dbt_utils_recency_fact_rates_validated_day__rate_date__7.e7a4def6bc", "compiled": true, "compiled_code": "\n\n\n\n\n\n\nwith recency as (\n\n    select \n\n      \n      \n        max(rate_date) as most_recent\n\n    from \"analytics\".\"main_validation\".\"fact_rates_validated\"\n\n    \n\n)\n\nselect\n\n    \n    most_recent,\n    cast(\n\n    (now() + cast(-7 as bigint) * interval 1 day) as timestamp) as threshold\n\nfrom recency\nwhere most_recent < cast(\n\n    (now() + cast(-7 as bigint) * interval 1 day) as timestamp)\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.581717Z", "completed_at": "2026-01-28T23:11:31.585274Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.585894Z", "completed_at": "2026-01-28T23:11:31.602424Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.025723934173583984, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_fact_rates_validated_base_currency.fbca55d066", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect base_currency\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\nwhere base_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.587138Z", "completed_at": "2026-01-28T23:11:31.590519Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.590970Z", "completed_at": "2026-01-28T23:11:31.607475Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.02509593963623047, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_fact_rates_validated_currency_pair.3f6066e910", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect currency_pair\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\nwhere currency_pair is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.597499Z", "completed_at": "2026-01-28T23:11:31.600213Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.600714Z", "completed_at": "2026-01-28T23:11:31.652281Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.058329105377197266, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_fact_rates_validated_exchange_rate.73cd41c512", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect exchange_rate\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\nwhere exchange_rate is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.604741Z", "completed_at": "2026-01-28T23:11:31.608340Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.608886Z", "completed_at": "2026-01-28T23:11:31.657989Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.058767080307006836, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_fact_rates_validated_extraction_id.b16e4d7145", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect extraction_id\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\nwhere extraction_id is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.610795Z", "completed_at": "2026-01-28T23:11:31.614446Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.614989Z", "completed_at": "2026-01-28T23:11:31.664192Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.05807805061340332, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_fact_rates_validated_rate_date.5c9013b57e", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect rate_date\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\nwhere rate_date is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.649892Z", "completed_at": "2026-01-28T23:11:31.653313Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.653806Z", "completed_at": "2026-01-28T23:11:31.668884Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.05491018295288086, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_fact_rates_validated_severity.f45c146618", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect severity\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\nwhere severity is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.658152Z", "completed_at": "2026-01-28T23:11:31.661009Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.661185Z", "completed_at": "2026-01-28T23:11:31.672612Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.016801118850708008, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_fact_rates_validated_target_currency.d97197675a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect target_currency\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\nwhere target_currency is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "pass", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.666015Z", "completed_at": "2026-01-28T23:11:31.670032Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.670214Z", "completed_at": "2026-01-28T23:11:31.675575Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.011590957641601562, "adapter_response": {"_message": "OK"}, "message": null, "failures": 0, "unique_id": "test.makerates.not_null_fact_rates_validated_validation_status.f2dcad4c20", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect validation_status\nfrom \"analytics\".\"main_validation\".\"fact_rates_validated\"\nwhere validation_status is null\n\n\n", "relation_name": null, "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.683090Z", "completed_at": "2026-01-28T23:11:31.686553Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.686693Z", "completed_at": "2026-01-28T23:11:31.703877Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.026832103729248047, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.mart_latest_rates", "compiled": true, "compiled_code": "\n\nWITH latest_rates AS (\n    SELECT * FROM \"analytics\".\"main_validation\".\"fact_rates_validated\"\n),\n\ncountries AS (\n    SELECT * FROM \"analytics\".\"main_analytics\".\"dim_countries\"\n)\n\nSELECT\n    r.rate_date,\n    r.base_currency,\n    r.target_currency,\n    c.country_name,\n    c.region,\n    r.exchange_rate,\n    r.inverse_rate,\n    r.consensus_variance,\n    r.validation_status,\n    r.severity\nFROM latest_rates r\nLEFT JOIN countries c ON r.target_currency = c.currency_code\nORDER BY r.rate_date DESC, c.region, r.target_currency", "relation_name": "\"analytics\".\"main_analytics\".\"mart_latest_rates\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.681415Z", "completed_at": "2026-01-28T23:11:31.687822Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.688249Z", "completed_at": "2026-01-28T23:11:31.708780Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.031102895736694336, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.mart_data_quality_metrics", "compiled": true, "compiled_code": "\n\n/*\nPipeline Health & Data Quality Metrics\n\nPurpose: SLA monitoring, detect stale data, track validation failures\nBusiness Value: Operations team monitors pipeline health, gets alerts if data >2 days old\n\nHealth Status:\n- HEALTHY: Fresh data (<2 days old), <5 flagged currencies, <10 warnings\n- WARNING: Some warnings (>10 warnings)\n- DEGRADED: Multiple failures (>5 flagged currencies)\n- STALE: Data too old (>2 days since last rate)\n*/\n\nWITH latest_extraction AS (\n    SELECT\n        MAX(extraction_timestamp) as last_extraction,\n        MAX(rate_date) as last_rate_date,\n        COUNT(DISTINCT target_currency) as currency_count,\n        COUNT(*) as total_records\n    FROM \"analytics\".\"main_validation\".\"fact_rates_validated\"\n),\n\nvalidation_stats AS (\n    SELECT\n        COUNT(*) as validated_count,\n        COUNT(*) FILTER (WHERE severity = 'OK') as ok_count,\n        COUNT(*) FILTER (WHERE severity = 'WARNING') as warning_count\n    FROM \"analytics\".\"main_validation\".\"fact_rates_validated\"\n    WHERE rate_date = (SELECT MAX(rate_date) FROM \"analytics\".\"main_validation\".\"fact_rates_validated\")\n),\n\nconsensus_stats AS (\n    SELECT\n        COUNT(*) as flagged_count,\n        AVG(frank_dev) as avg_variance,\n        MAX(frank_dev) as max_variance\n    FROM \"analytics\".\"main_validation\".\"consensus_check\"\n    WHERE status = 'FLAGGED'\n      AND rate_date = (SELECT MAX(rate_date) FROM \"analytics\".\"main_validation\".\"fact_rates_validated\")\n)\n\nSELECT\n    -- Freshness\n    e.last_extraction,\n    e.last_rate_date,\n    DATEDIFF('hour', e.last_extraction, CURRENT_TIMESTAMP) as hours_since_extraction,\n    DATEDIFF('day', e.last_rate_date, CURRENT_DATE) as days_since_rate,\n\n    -- Volume\n    e.currency_count,\n    e.total_records,\n\n    -- Validation\n    v.validated_count,\n    v.ok_count,\n    v.warning_count,\n    ROUND(v.ok_count::DOUBLE / NULLIF(v.validated_count, 0), 4) as ok_rate,\n\n    -- Consensus\n    COALESCE(c.flagged_count, 0) as flagged_count,\n    c.avg_variance,\n    c.max_variance,\n\n    -- Health Check\n    CASE\n        WHEN DATEDIFF('day', e.last_rate_date, CURRENT_DATE) > 2 THEN 'STALE'\n        WHEN COALESCE(c.flagged_count, 0) > 5 THEN 'DEGRADED'\n        WHEN v.warning_count > 10 THEN 'WARNING'\n        ELSE 'HEALTHY'\n    END as pipeline_status,\n\n    CURRENT_TIMESTAMP as dbt_loaded_at\n\nFROM latest_extraction e\nCROSS JOIN validation_stats v\nLEFT JOIN consensus_stats c ON 1=1", "relation_name": "\"analytics\".\"main_analytics\".\"mart_data_quality_metrics\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.679541Z", "completed_at": "2026-01-28T23:11:31.687957Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.689305Z", "completed_at": "2026-01-28T23:11:31.720661Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.043061017990112305, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.mart_currency_conversions", "compiled": true, "compiled_code": "\n\n/*\nPre-computed Currency Conversion Matrix\n\nPurpose: Provide direct conversion rates between top 10 currencies without manual calculation\nBusiness Value: Payment processing - convert USD invoice to GBP directly\n\nExample: To convert 100 USD to GBP, query WHERE from_currency='USD' AND to_currency='GBP'\n*/\n\n-- Pre-compute conversion matrix for top 10 currencies\nWITH top_currencies AS (\n    SELECT DISTINCT target_currency\n    FROM \"analytics\".\"main_validation\".\"fact_rates_validated\"\n    WHERE target_currency IN ('USD', 'EUR', 'GBP', 'JPY', 'AUD', 'CAD', 'CHF', 'CNY', 'HKD', 'SGD')\n    AND rate_date = (SELECT MAX(rate_date) FROM \"analytics\".\"main_validation\".\"fact_rates_validated\")\n),\n\nlatest_rates AS (\n    SELECT\n        rate_date,\n        target_currency,\n        exchange_rate as eur_rate,  -- EUR base (from fact table)\n        inverse_rate as to_eur_rate\n    FROM \"analytics\".\"main_validation\".\"fact_rates_validated\"\n    WHERE rate_date = (SELECT MAX(rate_date) FROM \"analytics\".\"main_validation\".\"fact_rates_validated\")\n)\n\n-- Cartesian product for all pairs (cross-rate calculation)\nSELECT\n    f.rate_date,\n    f.target_currency as from_currency,\n    t.target_currency as to_currency,\n    f.target_currency || '/' || t.target_currency as currency_pair,\n\n    -- Cross rate calculation: (1 EUR = X FROM) / (1 EUR = Y TO) = X/Y\n    (f.eur_rate / t.eur_rate) as exchange_rate,\n    (t.eur_rate / f.eur_rate) as inverse_rate,\n\n    CURRENT_TIMESTAMP as dbt_loaded_at\nFROM latest_rates f\nCROSS JOIN latest_rates t\nWHERE f.target_currency != t.target_currency  -- Exclude same currency\n  AND f.target_currency IN (SELECT target_currency FROM top_currencies)\n  AND t.target_currency IN (SELECT target_currency FROM top_currencies)\nORDER BY from_currency, to_currency", "relation_name": "\"analytics\".\"main_analytics\".\"mart_currency_conversions\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.685184Z", "completed_at": "2026-01-28T23:11:31.688114Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.690358Z", "completed_at": "2026-01-28T23:11:31.726420Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04797101020812988, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.mart_monthly_summary", "compiled": true, "compiled_code": "\n\n/*\nMonthly Currency Rate Summary\n\nPurpose: Pre-aggregated monthly rates for financial reporting and board presentations\nBusiness Value: Finance team gets monthly summaries for YoY comparisons, trend analysis\n\nAggregations included:\n- Min/Max/Avg/Median rates per month\n- Opening/Closing rates (first/last day of month)\n- Volatility percentage (range/average)\n- Standard deviation\n*/\n\nWITH monthly_data AS (\n    SELECT\n        DATE_TRUNC('month', rate_date) as month,\n        YEAR(rate_date) as year,\n        MONTH(rate_date) as month_num,\n        target_currency,\n        exchange_rate,\n        rate_date\n    FROM \"analytics\".\"main_validation\".\"fact_rates_validated\"\n    WHERE rate_date >= DATE_TRUNC('month', CURRENT_DATE - INTERVAL '24 MONTH')  -- 2 years of history\n)\n\nSELECT\n    month,\n    year,\n    month_num,\n    target_currency,\n\n    -- Aggregations\n    COUNT(*) as sample_count,\n    MIN(exchange_rate) as min_rate,\n    MAX(exchange_rate) as max_rate,\n    AVG(exchange_rate) as avg_rate,\n    MEDIAN(exchange_rate) as median_rate,\n    STDDEV(exchange_rate) as stddev_rate,\n\n    -- Volatility indicator (range as % of average)\n    (MAX(exchange_rate) - MIN(exchange_rate)) / AVG(exchange_rate) as volatility_pct,\n\n    -- First and last rate of month (opening/closing)\n    (SELECT exchange_rate FROM monthly_data m2\n     WHERE m2.month = m.month AND m2.target_currency = m.target_currency\n     ORDER BY rate_date ASC LIMIT 1) as opening_rate,\n    (SELECT exchange_rate FROM monthly_data m2\n     WHERE m2.month = m.month AND m2.target_currency = m.target_currency\n     ORDER BY rate_date DESC LIMIT 1) as closing_rate,\n\n    CURRENT_TIMESTAMP as dbt_loaded_at\n\nFROM monthly_data m\nGROUP BY 1, 2, 3, 4\nORDER BY month DESC, target_currency", "relation_name": "\"analytics\".\"main_analytics\".\"mart_monthly_summary\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.712462Z", "completed_at": "2026-01-28T23:11:31.715400Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.718271Z", "completed_at": "2026-01-28T23:11:31.735987Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.02652287483215332, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.mart_rate_analysis", "compiled": true, "compiled_code": "\n\nWITH daily_rates AS (\n    SELECT * FROM \"analytics\".\"main_validation\".\"fact_rates_validated\"\n)\n\nSELECT\n    rate_date,\n    base_currency,\n    target_currency,\n    exchange_rate,\n    -- Calculate 7-day Moving Average\n    AVG(exchange_rate) OVER (\n        PARTITION BY base_currency, target_currency \n        ORDER BY rate_date \n        ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n    ) as ma_7_day,\n    -- Calculate Daily Volatility (Change from previous day)\n    exchange_rate - LAG(exchange_rate) OVER (\n        PARTITION BY base_currency, target_currency \n        ORDER BY rate_date\n    ) as daily_change\nFROM daily_rates\nORDER BY base_currency, target_currency, rate_date DESC", "relation_name": "\"analytics\".\"main_analytics\".\"mart_rate_analysis\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2026-01-28T23:11:31.716416Z", "completed_at": "2026-01-28T23:11:31.720966Z"}, {"name": "execute", "started_at": "2026-01-28T23:11:31.721616Z", "completed_at": "2026-01-28T23:11:31.738631Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.023988962173461914, "adapter_response": {"_message": "OK"}, "message": "OK", "failures": null, "unique_id": "model.makerates.mart_rate_volatility", "compiled": true, "compiled_code": "\n\n/*\nCurrency Rate Volatility Analysis\n\nPurpose: Risk assessment for FX exposure management\nBusiness Value: Finance team identifies high-risk currencies for hedging decisions\n\nRisk Levels:\n- HIGH_RISK: >2% daily change OR >5% weekly change\n- MEDIUM_RISK: >1% daily change OR >3% weekly change\n- STABLE: Otherwise\n*/\n\nWITH daily_rates AS (\n    SELECT\n        rate_date,\n        target_currency,\n        exchange_rate,\n        LAG(exchange_rate, 1) OVER (PARTITION BY target_currency ORDER BY rate_date) as prev_rate,\n        LAG(exchange_rate, 7) OVER (PARTITION BY target_currency ORDER BY rate_date) as rate_7d_ago,\n        LAG(exchange_rate, 30) OVER (PARTITION BY target_currency ORDER BY rate_date) as rate_30d_ago\n    FROM \"analytics\".\"main_validation\".\"fact_rates_validated\"\n),\n\nmetrics AS (\n    SELECT\n        rate_date,\n        target_currency,\n        exchange_rate,\n\n        -- Daily change %\n        (exchange_rate - prev_rate) / NULLIF(prev_rate, 0) as daily_change_pct,\n\n        -- 7-day change %\n        (exchange_rate - rate_7d_ago) / NULLIF(rate_7d_ago, 0) as change_7d_pct,\n\n        -- 30-day change %\n        (exchange_rate - rate_30d_ago) / NULLIF(rate_30d_ago, 0) as change_30d_pct,\n\n        -- 7-day rolling stddev\n        STDDEV(exchange_rate) OVER (\n            PARTITION BY target_currency\n            ORDER BY rate_date\n            ROWS BETWEEN 6 PRECEDING AND CURRENT ROW\n        ) as volatility_7d,\n\n        -- 30-day rolling stddev\n        STDDEV(exchange_rate) OVER (\n            PARTITION BY target_currency\n            ORDER BY rate_date\n            ROWS BETWEEN 29 PRECEDING AND CURRENT ROW\n        ) as volatility_30d\n\n    FROM daily_rates\n)\n\nSELECT\n    rate_date,\n    target_currency,\n    exchange_rate,\n    daily_change_pct,\n    change_7d_pct,\n    change_30d_pct,\n    volatility_7d,\n    volatility_30d,\n\n    -- Risk flag\n    CASE\n        WHEN ABS(daily_change_pct) > 0.02 OR ABS(change_7d_pct) > 0.05 THEN 'HIGH_RISK'\n        WHEN ABS(daily_change_pct) > 0.01 OR ABS(change_7d_pct) > 0.03 THEN 'MEDIUM_RISK'\n        ELSE 'STABLE'\n    END as risk_level,\n\n    CURRENT_TIMESTAMP as dbt_loaded_at\n\nFROM metrics\nWHERE rate_date >= CURRENT_DATE - INTERVAL '90 DAY'  -- Keep 90 days of history\nORDER BY rate_date DESC, target_currency", "relation_name": "\"analytics\".\"main_analytics\".\"mart_rate_volatility\"", "batch_results": null}], "elapsed_time": 1.4881396293640137, "args": {"require_resource_names_without_spaces": true, "cache_selected_only": false, "require_batched_execution_for_custom_microbatch_strategy": false, "select": [], "upload_to_artifacts_ingest_api": false, "favor_state": false, "show_all_deprecations": false, "state_modified_compare_more_unrendered_values": false, "warn_error_options": {"error": [], "warn": [], "silence": []}, "exclude": [], "printer_width": 80, "profiles_dir": "/Users/manos/dev/makerates/dbt_project", "source_freshness_run_project_hooks": true, "include_saved_query": false, "require_nested_cumulative_type_params": false, "indirect_selection": "eager", "strict_mode": false, "quiet": false, "use_fast_test_edges": false, "show": false, "write_json": true, "log_path": "/Users/manos/dev/makerates/dbt_project/logs", "version_check": true, "populate_cache": true, "show_resource_report": false, "require_generic_test_arguments_property": true, "vars": {}, "export_saved_queries": false, "partial_parse": true, "partial_parse_file_diff": true, "require_ref_searches_node_package_before_root": false, "exclude_resource_types": [], "log_file_max_bytes": 10485760, "use_colors": true, "empty": false, "require_yaml_configuration_for_mf_time_spines": false, "print": true, "require_explicit_package_overrides_for_builtin_materializations": true, "log_level": "info", "validate_macro_args": false, "macro_debugging": false, "introspect": true, "use_colors_file": true, "static_parser": true, "log_format": "default", "require_unique_project_resource_names": false, "project_dir": "/Users/manos/dev/makerates/dbt_project", "state_modified_compare_vars": false, "require_all_warnings_handled_by_warn_error": false, "send_anonymous_usage_stats": true, "resource_types": [], "defer": false, "invocation_command": "dbt build", "log_level_file": "debug", "which": "build", "log_format_file": "debug", "skip_nodes_if_on_run_start_fails": false}}